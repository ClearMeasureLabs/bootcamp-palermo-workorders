---
description: Codebase structure, solution layout, and key paths for ChurchBulletin/Work Order app
alwaysApply: true
---

# Codebase Structure

## Solution and Projects

**Solution:** `src/ChurchBulletin.sln`

| Project | Path | Role |
|---------|------|------|
| Core | `src/Core/Core.csproj` | Domain; no dependencies |
| DataAccess | `src/DataAccess/DataAccess.csproj` | EF Core, MediatR handlers; refs Core only |
| Database | `src/Database/Database.csproj` | DB tooling, DbUp |
| UI.Server | `src/UI/Server/UI.Server.csproj` | Blazor Server host, Lamar DI |
| UI.Client | `src/UI/Client/UI.Client.csproj` | Blazor WASM |
| UI.Api | `src/UI/Api/UI.Api.csproj` | Web API |
| UI.Shared | `src/UI.Shared/UI.Shared.csproj` | Shared UI |
| LlmGateway | `src/LlmGateway/LlmGateway.csproj` | Azure OpenAI / Ollama |
| ChurchBulletin.AppHost | `src/ChurchBulletin.AppHost/` | Aspire AppHost |
| ChurchBulletin.ServiceDefaults | `src/ChurchBulletin.ServiceDefaults/` | Aspire defaults |
| Worker | `src/Worker/Worker.csproj` | Hosted endpoint worker service |
| UnitTests | `src/UnitTests/UnitTests.csproj` | NUnit + Shouldly |
| IntegrationTests | `src/IntegrationTests/IntegrationTests.csproj` | NUnit, LocalDB |
| AcceptanceTests | `src/AcceptanceTests/AcceptanceTests.csproj` | NUnit + Playwright |

## Onion Architecture (Strict)

- **Core** → no project references (MediatR.Contracts, health/logging abstractions only).
- **DataAccess** → references **Core** only (EF Core, MediatR; handlers live here).
- **UI*** → outer layer; may reference Core, DataAccess, UI.Shared, LlmGateway as needed.

## Key Paths by Concern

| Concern | Location |
|--------|----------|
| Domain models | `src/Core/Model/` (WorkOrder, Employee, WorkOrderStatus, Role, etc.) |
| Queries (CQRS) | `src/Core/Queries/` (e.g. WorkOrderByNumberQuery, EmployeeByUserNameQuery) |
| State commands | `src/Core/Model/StateCommands/`, `src/Core/Services/IStateCommand.cs` |
| Bus/MediatR | `src/Core/IBus.cs`; handlers in DataAccess and UI |
| EF context & mappings | `src/DataAccess/Mappings/` (DataContext, *Map.cs) |
| Query/command handlers | `src/DataAccess/Handlers/` |
| DB migrations (DbUp) | `src/Database/scripts/Update/` (###_Description.sql, TABS) |
| Blazor Server entry | `src/UI/Server/Program.cs`, `UIServiceRegistry.cs` |
| Blazor Client entry | `src/UI/Client/Program.cs`, `App.razor` |
| Worker entry | `src/Worker/Program.cs`, `WorkOrderEndpoint.cs` |
| API controllers | `src/UI/Api/Controllers/`, `src/UI/Server/Controllers/` |
| Health checks | DataAccess: `CanConnectToDatabaseHealthCheck`; LlmGateway: LLM; Server: aggregation |
| Build/test scripts | Repo root: `build.ps1`, `PrivateBuild.ps1`, `AcceptanceTests.ps1` |
| Arch docs | `arch/` (C4 PlantUML), `CLAUDE.md`, `.github/copilot-instructions.md` |

## Domain Snapshot

- **WorkOrder:** Number, Title, Description, RoomNumber, Assignee (Employee), Status, Creator (Employee), AssignedDate, CreatedDate, CompletedDate.
- **Employee:** UserName, FirstName, LastName, EmailAddress, Roles.
- **WorkOrderStatus:** Draft, Assigned, InProgress, Complete, Cancelled.
- **Role:** Name, CanCreateWorkOrder, CanFulfillWorkOrder.

## Dependencies

**.NET SDK:** 10.0.100 (see `global.json`)

| Project | Key NuGet Packages |
|---------|--------------------|
| Core | MediatR.Contracts 2.0.1, Microsoft.Extensions.Logging.Abstractions 10.0.0 |
| DataAccess | MediatR 12.4.1, Microsoft.EntityFrameworkCore 10.0.0, EF Core SqlServer + Sqlite, NServiceBus.Persistence.Sql.TransactionalSession 8.3.0 |
| Database | DbUp 5.0.41, dbup-sqlserver 6.0.16, Spectre.Console 0.54.0 |
| UI.Server | Lamar.Microsoft.DependencyInjection 15.0.1, OpenTelemetry 1.12.0, ModelContextProtocol 1.0.0, NServiceBus.Extensions.Hosting 3.0.1 |
| UI.Client | BlazorMvc 2.1.1, MediatR 12.4.1, Lamar 15.0.1, Microsoft.AspNetCore.Components.WebAssembly 10.0.0 |
| UI.Shared | BlazorMvc 2.1.1, MediatR 12.4.1, Microsoft.ApplicationInsights 2.23.0 |
| LlmGateway | Azure.AI.OpenAI 2.1.0, MediatR 12.4.1, Microsoft.Extensions.AI 9.7.0 |
| McpServer | ModelContextProtocol 1.0.0, Lamar 15.0.1, MediatR 12.4.1 |
| Worker | ClearMeasureLabs.HostedEndpoint.SqlServerTransport 1.0.30 |
| AppHost | Aspire.Hosting.AppHost 9.5.0 |
| ServiceDefaults | Azure.Monitor.OpenTelemetry.AspNetCore 1.3.0, OpenTelemetry 1.12.0 |
| UnitTests | NUnit 4.3.2, Shouldly 4.3.0, bunit 1.40.0, AutoBogus.Conventions 2.13.1 |
| IntegrationTests | NUnit 4.3.2, Shouldly 4.3.0, Microsoft.EntityFrameworkCore 10.0.0 |
| AcceptanceTests | NUnit 4.3.2, Playwright.NUnit 1.54.0, Azure.AI.OpenAI 2.1.0 |

## References for Agents

- **CLAUDE.md** – Build, test, DB, run, patterns, coding standards.
- **.github/copilot-instructions.md** – Copilot standards, quality gates, PR readiness.
- **.github/copilot-code-review-instructions.md** – PR review checklist.
- **.cursor/rules/cloud-agent-instructions.mdc** – Scope, workflow, issue protocol.
